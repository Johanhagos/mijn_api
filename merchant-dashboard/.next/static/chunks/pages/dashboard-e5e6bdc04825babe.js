(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[26],{528:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard",function(){return s(1409)}])},6447:function(e,t,s){"use strict";s.d(t,{Z:function(){return AuthGuard}});var a=s(5893),n=s(7294),l=s(1163),i=s(1842);function AuthGuard(e){let{children:t}=e,s=(0,l.useRouter)(),[r,c]=(0,n.useState)(!0);return((0,n.useEffect)(()=>{let e=!0;return(async()=>{try{await i.ZP.protectedApi("/merchant/usage"),e&&c(!1)}catch(t){e&&s.replace("/login")}})(),()=>{e=!1}},[s]),r)?(0,a.jsx)("div",{className:"p-8",children:"Checking authentication…"}):(0,a.jsx)(a.Fragment,{children:t})}},1409:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return Dashboard}});var a=s(5893),n=s(7294),l=s(1842),i=s(6447),r=s(9009),c=s(8687),d=s(4195),o=s(3023),x=s(5358),u=s(6050),m=s(6880);function RevenueChart(e){let{data:t=[],color:s="#0B74FF"}=e;return(0,a.jsxs)("div",{style:{width:"100%",height:240},className:"card",children:[(0,a.jsx)("h3",{className:"text-sm text-gray-500 mb-2",children:"Revenue (30 days)"}),(0,a.jsx)(r.h,{children:(0,a.jsxs)(c.w,{data:t,children:[(0,a.jsx)(d.q,{strokeDasharray:"3 3",stroke:"#e6eefc"}),(0,a.jsx)(o.K,{dataKey:"date",tick:{fontSize:12}}),(0,a.jsx)(x.B,{tickFormatter:e=>"".concat(e)}),(0,a.jsx)(u.u,{formatter:e=>new Intl.NumberFormat().format(Number(e))}),(0,a.jsx)(m.x,{type:"monotone",dataKey:"amount",stroke:s,strokeWidth:3,dot:!1})]})})]})}var h=s(3604),j=s(6208),p=s(3815),v=s(3558);function PaymentDonut(e){let{data:t=[],colors:s=["#0B74FF","#7C3AED"]}=e;return(0,a.jsxs)("div",{style:{width:"100%",height:240},className:"card",children:[(0,a.jsx)("h3",{className:"text-sm text-gray-500 mb-2",children:"Payment Split"}),(0,a.jsx)(r.h,{children:(0,a.jsxs)(h.u,{children:[(0,a.jsx)(j.b,{data:t,dataKey:"value",nameKey:"name",innerRadius:60,outerRadius:80,paddingAngle:4,children:t.map((e,t)=>(0,a.jsx)(p.b,{fill:s[t%s.length]},"cell-".concat(t)))}),(0,a.jsx)(u.u,{}),(0,a.jsx)(v.D,{})]})})]})}var g=s(1438);function ApiKeysList(e){let{keys:t=[],onRevoke:s}=e;return(0,a.jsxs)("div",{className:"card",children:[(0,a.jsx)("h3",{className:"text-sm text-gray-500 mb-3",children:"Active API Keys"}),(0,a.jsx)("div",{className:"space-y-3",children:0===t.length?(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"No keys yet."}):t.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("span",{className:"badge badge-live",children:(0,a.jsx)(g.Z,{size:14})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-mono text-sm",children:e.masked}),(0,a.jsxs)("div",{className:"text-xs text-gray-500",children:["Created ",e.created_at]})]})]}),(0,a.jsx)("div",{children:(0,a.jsx)("button",{className:"btn btn-ghost text-sm text-red-600",onClick:()=>null==s?void 0:s(e.id),children:"Revoke"})})]},e.id))})]})}function PluginSetup(e){let{snippet:t}=e,[s,l]=(0,n.useState)(!1),i=t||'<script src="https://example.com/plugin.js"></script>';return(0,a.jsxs)("div",{className:"card",children:[(0,a.jsx)("h3",{className:"text-sm text-gray-500 mb-3",children:"Plugin Setup"}),(0,a.jsx)("pre",{className:"p-3 bg-gray-50 rounded text-xs overflow-auto",children:i}),(0,a.jsx)("div",{className:"mt-3",children:(0,a.jsx)("button",{className:"btn btn-primary",onClick:()=>{var e;null===(e=navigator.clipboard)||void 0===e||e.writeText(i),l(!0),setTimeout(()=>l(!1),2e3)},children:s?"Copied":"Copy Embed Snippet"})})]})}function Dashboard(){var e,t,s;let[r,c]=(0,n.useState)(null),[d,o]=(0,n.useState)(!0),[x,u]=(0,n.useState)([]);(0,n.useEffect)(()=>{let e=!0,fetchUsage=async()=>{o(!0);try{let[t,s]=await Promise.all([l.ZP.protectedApi("/merchant/usage"),l.ZP.protectedApi("/api-keys")]);if(!e)return;c(t),u(s||[])}catch(e){console.error(e)}finally{e&&o(!1)}};fetchUsage();let t=setInterval(fetchUsage,3e3);return()=>{e=!1,clearInterval(t)}},[]);let m=((null==r?void 0:r.revenue)||[]).map(e=>({date:e.date,amount:e.amount})),h=[{name:"Web2",value:(null==r?void 0:r.web2_total)||0},{name:"Web3",value:(null==r?void 0:r.web3_total)||0}];return(0,a.jsx)(i.Z,{children:(0,a.jsxs)("div",{className:"container py-8",children:[(0,a.jsx)("div",{className:"flex items-center justify-between mb-6",children:(0,a.jsx)("h1",{className:"text-2xl font-bold",children:"Dashboard — Invoicing Merchant"})}),(0,a.jsxs)("div",{className:"grid grid-cols-4 gap-4 mb-6",children:[(0,a.jsxs)("div",{className:"card",children:[(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Total Revenue"}),(0,a.jsx)("p",{className:"text-2xl font-bold",children:null!==(e=null==r?void 0:r.total_amount)&&void 0!==e?e:"—"})]}),(0,a.jsxs)("div",{className:"card",children:[(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Web2 Payments"}),(0,a.jsx)("p",{className:"text-2xl font-bold",children:null!==(t=null==r?void 0:r.web2_count)&&void 0!==t?t:"—"})]}),(0,a.jsxs)("div",{className:"card",children:[(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Web3 Payments"}),(0,a.jsx)("p",{className:"text-2xl font-bold",children:null!==(s=null==r?void 0:r.web3_count)&&void 0!==s?s:"—"})]}),(0,a.jsxs)("div",{className:"card",children:[(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"API Keys"}),(0,a.jsx)("p",{className:"text-2xl font-bold",children:x.length})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[(0,a.jsx)("div",{className:"col-span-2",children:(0,a.jsx)(RevenueChart,{data:m.length?m:[{date:"01",amount:0}]})}),(0,a.jsx)("div",{children:(0,a.jsx)(PaymentDonut,{data:h})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,a.jsx)("div",{className:"col-span-2",children:(0,a.jsx)(ApiKeysList,{keys:x.map(e=>({id:e.id,key_type:e.type,masked:e.masked||e.id,created_at:e.created_at})),onRevoke:e=>{l.ZP.protectedApi("/api-keys/".concat(e),"DELETE").then(()=>u(t=>t.filter(t=>t.id!==e))).catch(()=>alert("Failed to revoke"))}})}),(0,a.jsx)("div",{children:(0,a.jsx)(PluginSetup,{snippet:'<script src="/plugin.js"></script>'})})]})]})})}}},function(e){e.O(0,[362,774,888,179],function(){return e(e.s=528)}),_N_E=e.O()}]);