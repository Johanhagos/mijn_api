<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout - APIBlockchain</title>
    <script src="https://js.stripe.com/v3/"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Montserrat', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .checkout-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 500px;
            width: 100%;
            padding: 40px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #3c64c6;
            margin-bottom: 10px;
        }
        
        h1 {
            font-size: 28px;
            color: #333;
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #666;
            font-size: 14px;
        }
        
        .order-summary {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .product-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .product-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .product-name {
            font-weight: 600;
            color: #333;
        }
        
        .product-price {
            color: #3c64c6;
            font-weight: 600;
        }
        
        .total {
            display: flex;
            justify-content: space-between;
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid #3c64c6;
        }
        
        .total-price {
            color: #3c64c6;
        }
        
        .form-section {
            margin-bottom: 25px;
        }
        
        .form-section label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .form-row.full {
            grid-template-columns: 1fr;
        }
        
        input, select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            font-family: 'Montserrat', sans-serif;
            transition: border-color 0.3s;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #3c64c6;
            box-shadow: 0 0 0 3px rgba(60, 100, 198, 0.1);
        }
        
        #card-element {
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
        }
        
        #card-element.StripeElement--focus {
            border-color: #3c64c6;
            box-shadow: 0 0 0 3px rgba(60, 100, 198, 0.1);
        }
        
        .StripeElement {
            padding: 10px;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .checkbox-group input[type="checkbox"] {
            width: auto;
            cursor: pointer;
        }
        
        .checkbox-group label {
            margin: 0;
            cursor: pointer;
            font-weight: 400;
            color: #666;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
        }
        
        button {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Montserrat', sans-serif;
        }
        
        .btn-pay {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-pay:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }
        
        .btn-pay:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .btn-back {
            background: #f0f0f0;
            color: #333;
        }
        
        .btn-back:hover {
            background: #e0e0e0;
        }
        
        .error-message {
            color: #e74c3c;
            font-size: 14px;
            margin-top: 8px;
            display: none;
        }
        
        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            display: none;
        }
        
        .loading {
            display: inline-block;
            width: 14px;
            height: 14px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .processing {
            display: none;
            text-align: center;
            padding: 30px;
        }
        
        .processing-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }
        
        .security-badge {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            color: #666;
            font-size: 12px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        
        .security-badge svg {
            width: 16px;
            height: 16px;
        }
        
        @media (max-width: 600px) {
            .checkout-container {
                padding: 25px;
            }
            
            h1 {
                font-size: 22px;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="checkout-container">
        <div class="header">
            <div class="logo">üîó apiblockchain</div>
            <h1>Complete Your Purchase</h1>
            <p class="subtitle">Secure payment powered by Stripe</p>
        </div>
        
        <div class="success-message" id="successMessage">
            ‚úì Payment processed successfully! Your order is confirmed.
        </div>
        
        <div class="order-summary">
            <div class="product-item">
                <span class="product-name">Blockchain Payment Gateway Setup</span>
                <span class="product-price">‚Ç¨299.00</span>
            </div>
            <div class="product-item">
                <span class="product-name">Smart Contract Invoicing Integration</span>
                <span class="product-price">‚Ç¨199.00</span>
            </div>
            <div class="total">
                <span>Total</span>
                <span class="total-price">‚Ç¨498.00</span>
            </div>
        </div>
        
        <form id="paymentForm">
            <!-- Billing Information -->
            <div class="form-section">
                <label>Full Name *</label>
                <input type="text" id="fullName" name="fullName" placeholder="John Doe" required>
            </div>
            
            <div class="form-section">
                <label>Email Address *</label>
                <input type="email" id="email" name="email" placeholder="john@example.com" required>
            </div>
            
            <div class="form-section">
                <label>Business Name</label>
                <input type="text" id="business" name="business" placeholder="Your Company" >
            </div>
            
            <div class="form-section">
                <label>Address *</label>
                <input type="text" id="address" name="address" placeholder="Street Address" required>
            </div>
            
            <div class="form-row">
                <div class="form-section">
                    <label>City *</label>
                    <input type="text" id="city" name="city" placeholder="Amsterdam" required>
                </div>
                <div class="form-section">
                    <label>Postal Code *</label>
                    <input type="text" id="postal" name="postal" placeholder="1012 AB" required>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-section">
                    <label>Country *</label>
                    <select id="country" name="country" required>
                        <option value="">Select Country</option>
                        <option value="NL">Netherlands</option>
                        <option value="DE">Germany</option>
                        <option value="FR">France</option>
                        <option value="BE">Belgium</option>
                        <option value="GB">United Kingdom</option>
                        <option value="US">United States</option>
                        <option value="CA">Canada</option>
                        <option value="AU">Australia</option>
                        <option value="SG">Singapore</option>
                        <option value="OTHER">Other</option>
                    </select>
                </div>
                <div class="form-section">
                    <label>Phone *</label>
                    <input type="tel" id="phone" name="phone" placeholder="+31 6 12345678" required>
                </div>
            </div>
            
            <!-- Card Information -->
            <div class="form-section">
                <label>Card Details *</label>
                <div id="card-element"></div>
                <div id="card-errors" class="error-message"></div>
            </div>
            
            <div class="checkbox-group">
                <input type="checkbox" id="terms" required>
                <label for="terms">I agree to the Terms of Service and Privacy Policy</label>
            </div>
            
            <div class="button-group">
                <button type="button" class="btn-back" onclick="window.location.href='/'">‚Üê Back</button>
                <button type="submit" class="btn-pay" id="payBtn">Pay ‚Ç¨498.00</button>
            </div>
        </form>
        
        <div class="processing" id="processingDiv">
            <div class="processing-icon">‚è≥</div>
            <div style="font-size: 16px; font-weight: 600;">Processing Payment...</div>
            <div style="color: #666; margin-top: 10px;">Please don't close this window</div>
        </div>
        
        <div class="security-badge">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
            </svg>
            Secured by Stripe
        </div>
    </div>
    
    <script>
        // Initialize Stripe
        const stripe = Stripe('pk_test_YOUR_STRIPE_KEY'); // Replace with your key
        const elements = stripe.elements();
        const cardElement = elements.create('card');
        cardElement.mount('#card-element');
        
        // Handle real-time validation errors
        cardElement.on('change', function(event) {
            const displayError = document.getElementById('card-errors');
            if (event.error) {
                displayError.textContent = event.error.message;
                displayError.style.display = 'block';
            } else {
                displayError.textContent = '';
                displayError.style.display = 'none';
            }
        });
        
        // Handle form submission
        document.getElementById('paymentForm').addEventListener('submit', async function(event) {
            event.preventDefault();
            
            const payBtn = document.getElementById('payBtn');
            const processingDiv = document.getElementById('processingDiv');
            
            // Validate form
            if (!document.getElementById('terms').checked) {
                alert('Please accept the Terms of Service');
                return;
            }
            
            // Show processing state
            payBtn.disabled = true;
            processingDiv.style.display = 'block';
            
            try {
                // Create payment method
                const { paymentMethod, error } = await stripe.createPaymentMethod({
                    type: 'card',
                    card: cardElement,
                    billing_details: {
                        name: document.getElementById('fullName').value,
                        email: document.getElementById('email').value,
                        address: {
                            line1: document.getElementById('address').value,
                            city: document.getElementById('city').value,
                            postal_code: document.getElementById('postal').value,
                            country: document.getElementById('country').value,
                        },
                        phone: document.getElementById('phone').value,
                    },
                });
                
                if (error) {
                    document.getElementById('card-errors').textContent = error.message;
                    document.getElementById('card-errors').style.display = 'block';
                    processingDiv.style.display = 'none';
                    payBtn.disabled = false;
                    return;
                }
                
                // Send to your backend
                const response = await fetch('/api/process-payment', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        paymentMethodId: paymentMethod.id,
                        amount: 49800, // ‚Ç¨498.00 in cents
                        currency: 'eur',
                        email: document.getElementById('email').value,
                        business: document.getElementById('business').value,
                    }),
                });
                
                const data = await response.json();
                
                if (data.success) {
                    processingDiv.style.display = 'none';
                    document.getElementById('paymentForm').style.display = 'none';
                    document.getElementById('successMessage').style.display = 'block';
                    
                    setTimeout(() => {
                        window.location.href = '/thank-you.html?order=' + data.orderId;
                    }, 2000);
                } else {
                    throw new Error(data.error || 'Payment failed');
                }
            } catch (err) {
                document.getElementById('card-errors').textContent = err.message;
                document.getElementById('card-errors').style.display = 'block';
                processingDiv.style.display = 'none';
                payBtn.disabled = false;
            }
        });
    </script>
</body>
</html>
